(()=>{"use strict";var e={742:(e,n)=>{for(var t=[],o=[],r="undefined"!==typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,c=a.length;u<c;++u)t[u]=a[u],o[a.charCodeAt(u)]=u;function i(e){var n=e.length;if(n%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=e.indexOf("=");return-1===t&&(t=n),[t,t===n?0:4-t%4]}function s(e,n,o){for(var r,a,u=[],c=n;c<o;c+=3)r=(e[c]<<16&16711680)+(e[c+1]<<8&65280)+(255&e[c+2]),u.push(t[(a=r)>>18&63]+t[a>>12&63]+t[a>>6&63]+t[63&a]);return u.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63}},n={};function t(o){var r=n[o];if(void 0!==r)return r.exports;var a=n[o]={exports:{}};return e[o](a,a.exports,t),a.exports}(()=>{const e={ERROR:5,WARN:4,INFO:3,DEBUG:2,LOG:1,OFF:100};let n=e.INFO,o=!1;const r={ERROR:"color:#FC0C1B;background-color:#FFEFEF",WARN:"color:#5B3A06;background-color:#FFFBE6",INFO:"color:#363F47;background-color:#e1e9ff",DEBUG:"color:#444;background-color:#eee",LOG:"color:#000;background-color:transparent",DEFAULT:"color:#000;background-color:transparent;font-weight:",ONEID:"color:#2887b4;background-color:transparent;font-weight:bold"};let a=c();function u(t){return n>e[t]?(e="",n={})=>{}:o?function(e){const n=["%c[OneID]%c %c[%s]%c: ",r.ONEID,r.DEFAULT,r[e],e,r.DEFAULT];return window.console[e.toLowerCase()].bind(window.console,...n)}(t):function(e){return window.console[e.toLowerCase()].bind(window.console,"[OneID] [%s]: ",e)}(t)}function c(){return{error:u("ERROR"),warn:u("WARN"),info:u("INFO"),debug:u("DEBUG"),log:u("LOG")}}const i=["CALL","CALL_DONE","EVENT"];function s(){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_=+";let n="";for(let t=0;t<24;t+=1){n+=e[Math.floor(Math.random()*e.length)]}return n}function d(e,n="DEFAULT"){const t=`PatchBay[${n}]`,o={},r={},u={};return Object.keys(e).forEach((n=>{e[n].onmessage=function(e){return n=>{if(!n||!n.data||"object"!==typeof n.data)return;const{data:t}=n;-1!==i.indexOf(t.type)&&(c(t.name,e,t),setTimeout(d.bind(null,t.name)))}}(n)})),{addHandler:function(e,n){if("function"!==typeof n)return;o[e]=n,d(e)},message:f,broadcast:function(n,t){const o={id:s(),type:"EVENT",data:t,name:n};c(n,null,o),setTimeout(d.bind(null,n)),Object.keys(e).forEach((e=>{f(e,n,t)}))},call:function(e,n,o){return new Promise(((r,c)=>{const i=s();a.debug(`${t}: call() invoked, target=${e}, name=${n}, id=${i}`),u[i]={resolve:r,reject:c},g(e,n,"CALL",o,i)}))}};function c(e,n,o){a.debug(`${t}: queueMessage(name=${e}, source=${n})`),r[e]||(r[e]=[]),r[e].push({source:n,data:o})}function d(e){if(a.debug(`${t}: flushQueue(name=${e})`),!Array.isArray(r[e])||r[e].length<1)return void a.debug(`${t}: Nothing in queue for '${e}', exit early`);const n=[];for(;r[e].length;){const{source:c,data:i}=r[e].pop(),s=i&&i.type||void 0,d=i&&i.id||void 0,f=`${t} - ${d||"NO_ID"}`;if(a.debug(`${f}: flushQueue loop, source=${c}, type=${s}`),"CALL"===s||"EVENT"===s){let t;if(!o[e]){a.debug(`${f}: flushQueue loop, NO HANDLER FOR name=${e}, deferring`),n.push({source:c,data:i});continue}a.debug(`${f}: flushQueue loop, about to call handler for name=${e}`),t=o[e](i&&i.data),a.debug(`${f}: flushQueue loop, obtained return value from name=${e}`),"CALL"===s&&(t&&t.then||(a.debug(`${f}: flushQueue loop, handler for name=${e} returned plain value`),t=Promise.resolve(t)),t.then((n=>{a.debug(`${f}: flushQueue, promise resolved for name=${e}, messaging back`),l(c,e,n,d,"resolved")})).catch((n=>{a.debug(`${f}: flushQueue, promise caught error for name=${e}, messaging back`),l(c,e,n,d,"rejected")})))}if("CALL_DONE"===s){const{status:e}=i;if(!u[d]){a.debug(`${f}: flushQueue loop, pendingCalls EMPTY FOR id=${d}!!!`);continue}"resolved"===e?(a.debug(`${f}: flushQueue loop, resolving promise for id=${d}`),u[d].resolve(i.data)):(a.debug(`${f}: flushQueue loop, rejecting promise for id=${d}`),u[d].reject(i.data)),delete u[d]}}for(const o of n)a.debug(`${t}: flushQueue, pushing deferred item back into queue, name=${e}`),r[e].push(o)}function l(e,n,t,o,r){g(e,n,"CALL_DONE",t,o,r)}function f(e,n,t){g(e,n,"EVENT",t)}function g(o,r,u,i,l,f){if(l=l||s(),o===n)return a.debug(`${t}: Target is self...`),c(r,o,{id:l,type:u,name:r,data:i,status:f}),void setTimeout(d.bind(null,r));e[o]?e[o].postMessage({id:l,type:u,name:r,data:i,status:f}):a.debug(`${t}: Target '${o}' has not been registered!!!`)}}const l=(f="responder",new Promise((e=>{const n={};window.addEventListener("message",(function t(o){o.data&&o.data.targetName===f&&("comm-bootstrap-start"===o.data.event&&o.source.postMessage({event:"comm-bootstrap-ack",targetName:f},"*"),"comm-bootstrap-data"===o.data.event&&(n[o.data.port]=o.ports[0],Object.keys(n).length>=o.data.ports.length&&(window.removeEventListener("message",t),e(n))))}))}))).then((e=>new d(e,"responder")));var f;t(742);function g(e=""){if("string"!==typeof e)return 0;let n=-1;const t=function(){const e=new Array(256);for(let n=0;n<e.length;n++){let t=n;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t>>>0}return e}();for(let o=0;o<e.length;o++)n=n>>>8^t[255&(n^e.charCodeAt(o))];return(-1^n)>>>0}const $="ac",p="ab2",h="idn",m="rt",w="token",b="ts",v=/^\.?www/,E=/^\./;function k(e){return e&&document.cookie.replace(new RegExp(`(?:(?:^|.*;\\s*)${e}\\s*\\=\\s*([^;]*).*$)|^.*$`),"$1")||null}function L(e,n,t){if(document.cookie=`${encodeURIComponent(e)}=; expires=Thu, 01 Jan 1970 00:00:00 GMT${n?`; domain=${n}`:""}${t?`; path=${t}`:""}`,n&&!v.test(n)){const o=`www${/^\./.test(n)?"":"."}${n}`;a.debug(`also deleting cookie from ${o}`),L(e,o,t)}return!0}function y(e){let n=window.location.hostname;v.test(n)&&(n=n.replace(v,""),n=n.replace(E,""));const t="localhost"===n?n:`.${n}`;a.debug("responder: guestLogout");[p,h,m,w,b].forEach((n=>{const o=`${e}.${n}`;a.debug(`deleting cookie: ${o}`),L(o,t,"/")})),a.debug(`deleting cookie: ${e}-${$}`),L(`${e}-${$}`,t,"/")}const O=18e5,A=9e5;function D(e){if(!e)return null;return k(`device_${g(e).toString(16)}`)}function R({deviceId:e,loginValue:n}){if(!e||!n)return null;const t=g(n),o=new Date;o.setDate(o.getDate()+1),T({key:`device_${t.toString(16)}`,value:e,expires:o,secure:!0})}function N(){const e=new URLSearchParams(window.location.search);return k(`${e.get("clientId")}-${e.get("environment")}.${p}`)}function F(){const e=new URLSearchParams(window.location.search),n=e.get("clientId"),t=e.get("environment"),o=new Date(Date.now()+O);T({key:`${n}-${t}.${p}`,value:o.toISOString(),expires:o,secure:!0})}function T({key:e,value:n,expires:t,secure:o=!1}){const r=window.location.hostname;!function(e,n,t,o,r,u){let c,i=!1;if(v.test(t)&&(t=t.replace(v,""),i=!0),!e||/^(?:expires|max-age|path|domain|secure)$/i.test(e))return!1;if(c=`${e}=${n}`,r&&r instanceof Date&&(c+=`; expires=${r.toUTCString()}`),t&&(c+=`; domain=${t}`),o&&(c+=`; path=${o}`),u&&(c+="; secure"),document.cookie=c,i){const n=`www${/^\./.test(t)?"":"."}${t}`;a.debug(`calling delete on domain ${n}`),L(e,n,o||"")}}(e,n,"localhost"===r?r:`.${r}`,"/",t,o)}function I({recoveryToken:e}){const n=new URLSearchParams(window.location.search),t=n.get("clientId"),o=n.get("environment"),r=new Date(Date.now()+A);T({key:`${t}-${o}.${m}`,value:e,expires:r,secure:!0})}function C(){const e=new URLSearchParams(window.location.search);return k(`${e.get("clientId")}-${e.get("environment")}.${m}`)}l.then((e=>{e.addHandler("deviceID.read",D),e.addHandler("deviceID.write",R),e.addHandler("ageBandGating.read",N),e.addHandler("ageBandGating.write",F),e.addHandler("otpRecoveryToken.write",I),e.addHandler("otpRecoveryToken.read",C),e.addHandler("get.apiKey",k),e.addHandler("get.cookie",k),e.addHandler("set.cookie",T),e.addHandler("delete.cookie",L),e.addHandler("guest.logout",y)}))})()})();